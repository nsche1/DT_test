(function(n){var f=n("<video />")[0],s=typeof f.canPlayType!="undefined",e=typeof f.webkitEnterFullScreen!="undefined",o,t,u,i;navigator.userAgent.match("Chrome")&&(e=!1);var h=n("<input type='range' />")[0],c=typeof h.max!="undefined",r={autoplay:!1,controls:!1,preload:"auto",poster:null,srcs:[],keyShortcut:!0,flashSrc:"media/FlareVideo.swf"};for(r.useNative=s,r.useNativeFullScreen=e,o="mousemove keydown DOMMouseScroll mousewheel mousedown reset.idle",n.fn.idleTimerVideo=function(t){var e;t=t||{};var i=n(this),r=!1,s=t.timeout||2500,f=t.interval||1e3,u=0,h=function(){r&&i.trigger("idle",!1);r=!1;u=0},c=function(){u>=s?(r||i.trigger("idle",!0),r=!0):u+=f};i.bind(o,h);e=setInterval(c,f);i.unload(function(){clearInterval(e)})},t=function(){},t.prototype.init=function(i,u){if(this._class=t,this.parent=i,this.options=n.extend({},r,u),this.options.useNative=!1,this.sources=this.options.srcs||this.options.sources,this.useNative=this.options.useNative,this.options.useFullScreen=!!this.useNative,this.state=null,this.canPlay=!1,this.inFullScreen=!1,this.loaded=!1,this.readyList=[],u.useParentAsElement&&(this.element=i),this.setupElement(),this.options.useNative)this.setupNative();else return this;return this.ready(n.proxy(function(){this.setupEvents();this.setupControls();this.change("initial");this.load();this.element.idleTimerVideo();this.element.bind("idle",n.proxy(this.idle,this));this.element.bind("state.fv",n.proxy(function(){this.element.trigger("reset.idle")},this))},this)),this},t.fn=t.prototype,t.fn.ready=function(n){this.readyList.push(n);this.loaded&&n.call(this)},t.fn.load=function(t){t&&(this.sources=t);typeof this.sources=="string"&&(this.sources={src:this.sources});n.isArray(this.sources)||(this.sources=[this.sources]);this.ready(function(){this.change("loading");this.video.loadSources(this.sources)})},t.fn.play=function(){this.video.play()},t.fn.pause=function(){this.video.pause()},t.fn.stop=function(){this.seek(0);this.pause()},t.fn.togglePlay=function(){this.state=="playing"?this.pause():this.play()},t.fn.fullScreen=function(n){typeof n=="undefined"&&(n=!0);this.inFullScreen=n;this.options.useNativeFullScreen?this.video[n?"enterFullScreen":"exitFullScreen"]():this.inFullScreen=!1},t.fn.toggleFullScreen=function(){this.fullScreen(!this.inFullScreen)},t.fn.seek=function(n){this.video.setCurrentTime(n)},t.fn.setVolume=function(n){this.video.setVolume(n)},t.fn.getVolume=function(){return this.video.getVolume()},t.fn.mute=function(n){typeof n=="undefined"&&(n=!0);var t=this.getVolume();this.lastVolume||(this.lastVolume=1);this.setVolume(n?this.lastVolume:0);t>0&&(this.lastVolume=t)},t.fn.remove=function(){this.element.remove()},t.fn.bind=function(){this.videoElement.bind.apply(this.videoElement,arguments)},t.fn.one=function(){this.videoElement.one.apply(this.videoElement,arguments)},t.fn.trigger=function(){this.videoElement.trigger.apply(this.videoElement,arguments)},u=["onerror","onloadeddata","oncanplay","ondurationchange","ontimeupdate","onpause","onplay","onended","onvolumechange"],i=0;i<u.length;i++)(function(){var r=u[i],f=r.replace(/^(on)/,"");t.fn[r]=function(){var t=n.makeArray(arguments);t.unshift(f);this.bind.apply(this,t)}})();t.fn.triggerReady=function(){for(var n in this.readyList)this.readyList[n].call(this);this.loaded=!0};t.fn.setupElement=function(){var t=!this.element;t&&(this.element=n("<div />"));this.element.addClass("flareVideo");t&&this.parent.append(this.element)};t.fn.idle=function(n,t){t?this.state=="playing"&&this.element.addClass("idle"):this.element.removeClass("idle")};t.fn.change=function(n){this.state=n;this.element.attr("data-state",this.state);this.element.trigger("state.fv",this.state)};t.fn.setupNative=function(){var t;this.videoElement=this.element.find("video:first");this.videoElement||(this.videoElement=n("<video />"),this.videoElement.addClass("video"),this.videoElement.attr({width:this.options.width,height:this.options.height,poster:this.options.poster,autoplay:this.options.autoplay,preload:this.options.preload,controls:this.options.controls,autobuffer:this.options.autobuffer}),this.element.append(this.videoElement));this.video=this.videoElement[0];t=this;this.video.loadSources=function(){t.video.load()};this.video.getStartTime=function(){return this.startTime||0};this.video.getEndTime=function(){return this.duration==Infinity&&this.buffered?this.buffered.end(this.buffered.length-1):(this.startTime||0)+this.duration};this.video.getCurrentTime=function(){try{return this.currentTime}catch(n){return 0}};t=this;this.video.setCurrentTime=function(n){this.currentTime=n};this.video.getVolume=function(){return this.volume};this.video.setVolume=function(n){this.volume=n};this.video.enterFullScreen=function(){t.inFullScreen=!1;this.webkitEnterFullScreen()};this.video.exitFullScreen=function(){this.webkitExitFullScreen()};this.videoElement.dblclick(n.proxy(function(){this.toggleFullScreen()},this));this.triggerReady()};t.fn.setupButtons=function(){var r=n("<div />"),i,t;r.addClass("play");r.text("Play");r.click(n.proxy(function(){this.canPlay&&this.play()},this));this.controls.append(r);i=n("<div />");i.addClass("pause");i.text("Pause");i.click(n.proxy(function(){this.canPlay&&this.pause()},this));this.controls.append(i);t=n("<div />");t.addClass("fullScreen");t.text("Full Screen");t.click(n.proxy(this.toggleFullScreen,this));this.options.useFullScreen||t.addClass("disabled");this.controls.append(t)};t.fn.createRange=function(){var t,i;if(c)t=n("<input type='range' />"),t.attr({step:"any"}),t.getValue=t.val,t.setValue=t.val,t.setOptions=t.attr;else{if(t=n("<div />"),!t.slider)throw"jQuery UI with the slider component is required.";t.slider();i=0;t.getValue=function(){return i};t.setValue=function(n){t.find(".ui-slider-handle:first").hasClass("ui-state-active")||(i=n,t.slider("option","value",n))};t.setOptions=function(n){t.slider("option",n)};t.bind("slidestop",function(n,r){i=r.value;t.trigger("change")})}return t};t.fn.setupSeek=function(){var i=n("<div />"),t;i.addClass("seek");t=this.createRange();t.addClass("seekRange");t.setValue(0);t.change(n.proxy(function(){this.seek(t.getValue())},this));this.ondurationchange(n.proxy(function(){t.setOptions({min:this.video.getStartTime(),max:this.video.getEndTime(),value:this.video.getCurrentTime()})},this));this.ontimeupdate(n.proxy(function(){t.setOptions({max:this.video.getEndTime(),value:this.video.getCurrentTime()})},this));i.append(t);this.controls.append(i)};t.fn.setupVolume=function(){var i=n("<div />"),t;i.addClass("volume");t=this.createRange();t.setOptions({max:1,step:.1});t.addClass("volRange");t.change(n.proxy(function(){this.setVolume(t.getValue())},this));this.onvolumechange(n.proxy(function(){t.setValue(this.getVolume())},this));t.setValue(this.getVolume());i.append(t);this.controls.append(i)};t.fn.setupTiming=function(){var i=n("<div />"),r=n("<div />"),t,u;i.addClass("timeMin");r.addClass("timeMax");t=function(n){return n<10?"0"+n:n};u=function(n){var i=[],f=Math.floor(n/60),u=Math.floor(n/3600),r=n==0?0:n%60;return r=Math.round(r),u>0&&i.push(t(u)),i.push(t(f)),i.push(t(r)),i.join(":")};this.ontimeupdate(n.proxy(function(){i.text(u(this.video.getCurrentTime()));r.text("-"+u(this.video.getEndTime()-this.video.getCurrentTime()))},this));this.videoElement.one("canplay",n.proxy(function(){this.videoElement.trigger("timeupdate")},this));this.controls.append(i);this.controls.append(r)};t.fn.setupControls=function(){this.options.controls||(this.controls=n("<div />"),this.controls.addClass("controls"),this.controls.addClass("disabled"),this.setupButtons(),this.setupSeek(),this.setupVolume(),this.setupTiming(),this.element.append(this.controls))};t.fn.setupEvents=function(){this.onpause(n.proxy(function(){this.element.removeClass("playing");this.change("paused")},this));this.onplay(n.proxy(function(){this.element.addClass("playing");this.change("playing")},this));this.onended(n.proxy(function(){this.element.removeClass("playing");this.fullScreen(!1);this.stop();this.change("ended")},this));this.onerror(n.proxy(function(){if(this.useNative)if(this.video.error&&this.video.error.code==4){var n=this.flashSources()[0];n?this.fallbackToFlash():console.error("Format not supported")}else console.error("Error - "+this.video.error);else console.error("Flash error")},this));this.oncanplay(n.proxy(function(){this.canPlay=!0;this.controls.removeClass("disabled")},this));this.options.keyShortcut;n(document).keydown(n.proxy(function(n){return n.keyCode==32?(this.togglePlay(),!1):n.keyCode==27&&this.inFullScreen?(this.fullScreen(!1),this.element.trigger("reset.idle"),!1):void 0},this))};n.fn.flareVideo=function(n){return(new t).init(this,n)};window.FlareVideo=t})(jQuery)